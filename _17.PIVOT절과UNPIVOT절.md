# PIVOT절과 UNPIVOT절



'PIVOT은 회전시킨다' 는 의미를 가짐.

***PIVOT 절은 행을 열로 회전시키고, UNPIVOT절은 열을 행으로 회전***



## PIVOT 절

![image-20200328154925956](https://tva1.sinaimg.cn/large/00831rSTgy1gd9n6zrppkj31cu0u0tx2.jpg)





### 기본 문법

![image-20200328155927694](https://tva1.sinaimg.cn/large/00831rSTgy1gd9nhewglaj31c60see81.jpg)



```sql
SELECT * FROM (SELECT job, deptno, sal FROM emp) 
    PIVOT (SUM(sal) FOR deptno IN(10,20,30))
ORDER BY 1;
```

![image-20200328160040824](https://tva1.sinaimg.cn/large/00831rSTgy1gd9ninlbpzj30no0ocgo4.jpg)



![image-20200328160136668](https://tva1.sinaimg.cn/large/00831rSTgy1gd9njq640zj31360u0nnc.jpg)



![image-20200328160438792](https://tva1.sinaimg.cn/large/00831rSTgy1gd9nmvebkzj31by0my1b9.jpg)



**기존방식**

![image-20200328160551921](https://tva1.sinaimg.cn/large/00831rSTgy1gd9no2cdvcj31880u0dy0.jpg)



## UNPIVOT 절

*UNPIVOT 절은 PIVOT절과 반대로 동작. 열이 행으로 전환*

![image-20200328160644046](https://tva1.sinaimg.cn/large/00831rSTgy1gd9nozd112j31c00q8dyq.jpg)



**기본 문법**

![image-20200328160707782](https://tva1.sinaimg.cn/large/00831rSTgy1gd9npecjc7j31c60ng7wh.jpg)



```SQL
-- example
DROP TABLE t1 PURGE;

CREATE TABLE t1 AS
SELECT job, d10_sal, d20_sal, d10_cnt, d20_cnt
FROM
(SELECT job, deptno, sal FROM emp WHERE job IN('ANALYST', 'CLERK'))
    PIVOT (SUM(sal) AS sal, COUNT(*) AS cnt
    FOR deptno IN(10 AS d10, 20 AS d20));

SELECT * FROM t1;
```



UNPIVOT 를 활용해보면

```sql
SELECT job, deptno, sal FROM t1 UNPIVOT (sal FOR deptno IN (d10_sal, d20_sal))
ORDER BY 1,2;
```



![image-20200328161202369](https://tva1.sinaimg.cn/large/00831rSTgy1gd9nugon94j30yg0lamz7.jpg)

