# TOP-N 쿼리

**Top-N 쿼리는 말 그대로 상위(Top) N개의 행을 조회하는 쿼리**

*Top-N 쿼리는 시스템 성능에 미치는 영향이 크기 때문에 작성 표준을 신중하게 결정해야 한다.* 

## 기본 문법

- ROWNUM 방식
- 분석 함수 방식
- ROW LIMITING 방식



## 1. ROWNUM 방식

오라클 DB의 전통적인 Top-N 쿼리 방식.

**ORDER BY 절로 행을 정렬하고, 정렬된 행을 ROWNUM 슈도 칼럼으로 제한.**



ROWNUM 슈도 칼럼은 행이 반환되는 순서대로 순번을 반환

```sql
SELECT empno, sal ROWNUM AS rn FROM emp;
```

아래 쿼리는 결과 반환 X ROWNUM 슈도 칼럼은 1부터 시작하고, 행이 반환될 때마다 순번이 증가하기 때문에 ROWNUM=2 조건은 항상 FALSE.

```sql
SELECT empno, sal ROWNUM AS rn FROM emp WHERE ROWNUM = 2;
```



아래와 같이 사용해야 함

```sql
SELECT empno, sal, ROWNUM AS rn FROM emp WHERE ROWNUM <=2;
```

![image-20200324110319199](https://tva1.sinaimg.cn/large/00831rSTgy1gd4sg0nm22j31440qewrz.jpg)



`ORDER BY` 가`WHERE` 보다 나중에 동작되기 때문에 의도된 순서대로 안나옴.

*그럼 어떻게?*



`인라인 뷰를 사용 (Inline View)`

![image-20200324110431199](https://tva1.sinaimg.cn/large/00831rSTgy1gd4shabx7cj30u00w9e2l.jpg)



## 2. 분석 함수 방식

![image-20200324111728069](https://tva1.sinaimg.cn/large/00831rSTgy1gd4suqxltvj312a0l2wn9.jpg)

![image-20200324111752687](https://tva1.sinaimg.cn/large/00831rSTgy1gd4svbyajbj30u011l7wh.jpg)

## ROW LIMITING 절

12.1 버전부터 사용 가능.

![image-20200324111852274](https://tva1.sinaimg.cn/large/00831rSTgy1gd4sw8twvmj30y70u0kim.jpg)

//TODO 고급 주제