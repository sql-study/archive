하나의 쿼리 블록으로 구성된 쿼리. 쿼리 블록은 다른 쿼리 블록을 포함할 수 있다. 다른 쿼리 블록에 초함된 쿼리 블록을 **서브 쿼리**, 다른 쿼리 블록을 포함한 쿼리 블록을 **메인 쿼리**



![image-20200321201322549](https://tva1.sinaimg.cn/large/00831rSTgy1gd1rhfhsmcj30z40f6thl.jpg)



서브 쿼리는 사용 위치에 따라 중첩 서브 쿼리, 스칼라 서브 쿼리, 인라인 뷰



**중첩 서브 쿼리 - WHERE 절, HAVING 절**

**스칼라 서브 쿼리 - SELECT 절**

**인라인 뷰 - FROM 절**



```sql
DROP TABLE t1 PURGE;
DROP TABLE t2 PURGE;

CREATE TABLE t1(c1 NUMBER NOT NULL, C2 NUMBER NOT NULL);
CREATE TABLE t2(c1 NUMBER NOT NULL, C2 NUMBER);

INSERT INTO t1 VALUES (1, 2);
INSERT INTO t1 VALUES (2, 1);
INSERT INTO t1 VALUES (2, 3);
INSERT INTO t1 VALUES (3, 4);
INSERT INTO t2 VALUES (1, 2);
INSERT INTO t2 VALUES (2, 3);
INSERT INTO t2 VALUES (3, NULL);
```

# 중첩 서브 쿼리(nested subquery)

중첩 서브 쿼리는 WHERE 절과 HAVING 절에 사용하는 서브 쿼리.

```
비상관(uncorrelated subquery) 서브 쿼리 - 메인 쿼리와 관계 없음.
상관(correlated subquery) 서브 쿼리 - 메인 쿼리와 관계 있음.
```

서브 쿼리가 반환하는 행의 개수에 따라 단일 행 서브 쿼리와 다중 행 서브 쿼리로도 구분

```
단일 행 서브 쿼리 - 서브 쿼리가 단일 행을 반환
다중 행 서브 쿼리 - 서브 쿼리가 다중 행을 반환
```

## 1. 비상관 서브 쿼리

- 메인 쿼리와 관계가 없는 서브 쿼리. 서브 쿼리의 WHERE 절에 메인 쿼리와의 조인 조건이 존재하지 않는다.
- 비상관 서브 쿼리가 반환하는 행의 개수에 따라 단일 행 비상관 서브 쿼리와 다중 행 비상관 서브 쿼리로 구분



### 1.1 단일 행 비상관 서브 쿼리

단일 행을 반환하는 비상관 서브 쿼리. 주로 비교 조건을 사용.

```sql
SELECT * FROM t1 WHERE c1 = (SELECT MAX (c1) AS c1 FROM t2);
-- 단일 행 쿼리가 반환되서 결과가 반환된다.
---
SELECT * FROM t1 WHERE c1 = 2;
```

```sql
SELECT * FROM t1 WHERE (c1, c2) = (SELECT MAX(c1), MAX(c2) FROM t2);
-- 다중 열일 경우는 위와같이
---
SELECT * FROM t1 WHERE (c1, c2) = ((2,3));
```

`HAVING` 절에도 서브 쿼리를 사용할 수 있음.



### 1.1 다중 행 비상관 서브 쿼리

다중 행을 반환하는 비상관 서브 쿼리. 주로 `IN 조건`

#### IN 조건

서브 쿼리의 결과에 해당하는 메인 쿼리의 행을 조회

```sql
SELECT * FROM t1 WHERE c1 IN (SELECT c1 FROM t2);
-- 
---
SELECT * FROM t1 WHERE c1 IN (1,2);
```



#### ANY조건과 ALL조건

ANY 조건은 서브 쿼리 결과의 일부, ALL 조건은 서브 쿼리 결과의 전체를 비교하여 조건에 만족하는 행을 반환

![image-20200322135525351](https://tva1.sinaimg.cn/large/00831rSTgy1gd2m6hkqfvj310e0mgwuw.jpg)

## 상관 서브 쿼리

메인 쿼리와 관계가 있는 서브 쿼리. 서브 쿼리의 WHERE 절에 메인 쿼리와의 조인조건이 존재.

상관 서브 쿼리도 서브 쿼리가 반환하는 행의 개수에 따라 

**단일 행 상관 서브 쿼리**와 **다중 행 상관 서브 쿼리**로 구분



### 1. 단일 행 상관 서브 쿼리

### 2. 다중 행 상관 서브 쿼리



## 사용 기준



# 스칼라 서브 쿼리

# 인라인 뷰

# 사용 기준

# WITH 절

## 1. SUBQUERY FACTORING 절

## 2. PL/SQL 선언

