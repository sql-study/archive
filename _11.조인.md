# Join

하나의 쿼리로 다수의 테이블을 조회.



***조인의 기본원리***

1. 조인 조건
2. 조인 범위
3. 조인 차수



```sql
DROP TABLE t1 PURGE;
DROP TABLE t2 PURGE;
DROP TABLE t3 PURGE;
CREATE TABLE t1 (c1 NUMBER, CONSTRAINT t1_pk PRIMARY KEY (C1));
CREATE TABLE t2 (c1 NUMBER, CONSTRAINT t2_pk PRIMARY KEY (C1));
CREATE TABLE t3 (c1 NUMBER, CONSTRAINT t3_pk PRIMARY KEY (C1));

INSERT INTO t1 VALUES (1);
INSERT INTO t1 VALUES (2);
INSERT INTO t1 VALUES (3);
INSERT INTO t2 VALUES (1);
INSERT INTO t2 VALUES (2);
INSERT INTO t3 VALUES (1);
INSERT INTO t3 VALUES (3);
COMMIT;
```

![image-20200321175859633](https://tva1.sinaimg.cn/large/00831rSTgy1gd1nloh6wtj31du0k2h3l.jpg)

## 1.조인조건

### 1.1 카티션 곱

조인 조건이 없는 조인?

`SELECT a.c1 AS a, b.c1 AS b FROM t1 a, t2 b ORDER BY 1, 2;`

`ORDER BY 1,2` 의 의미는?



![image-20200321180128508](https://tva1.sinaimg.cn/large/00831rSTgy1gd1noaj0d4j31do0sak4y.jpg)



언제 카티션곱을 쓰는가? **행 복제를 위해 의도적으로 카티션 곱을 발생 시킴**

### 1.2 등가 조인

조인 조건이 모두 등호(=)인 조인. 값이 동일한 경우에만 행이 반환

`SELECT a.c1 AS a, b.c1 AS b FROM t1 a, t2 b WHERE b.c1 = a.c1 ORDER BY 1,2;`

![image-20200321180646522](https://tva1.sinaimg.cn/large/00831rSTgy1gd1ntpf6hrj31ea0g0tiq.jpg)



### 1.3 비등가 조인

등호 외의 다른 조인 조건이 있는 조인

![image-20200321181448133](https://tva1.sinaimg.cn/large/00831rSTgy1gd1o26yr4yj30vm0u0wv9.jpg)

## 2.조인범위

- 조인 범위는 이너(inner)와 아우터(outer)로 구분.

- 조인이 성공한 범위를 이너, 실패한 범위를 아우터로 부르자.

- 조인은 조인의 범위에 따라 이너 조인과 아우터 조인으로 구분

![image-20200321181648022](https://tva1.sinaimg.cn/large/00831rSTgy1gd1o43ywnyj30vq0c441e.jpg)



### 2.1 이너 조인

조인이 성공한 점위를 반환.



널을 포함한 이너 조인을 살펴봅시당.

![image-20200321183252731](https://tva1.sinaimg.cn/large/00831rSTgy1gd1okv1w7zj314o0qodik.jpg)



이너조인을 하면 NULL은 생략된 결과값을 가진다.



### 2.2 아우터 조인



```sql
CREATE TABLE t1 (c1 NUMBER, c2 NUMBER);
CREATE TABLE t2(c1 NUMBER);
CREATE TABLE t3(c1 NUMBER);
CREATE TABLE t4(c1 NUMBER);

INSERT INTO t1 VALUES (1,1);
INSERT INTO t1 VALUES (2,2);
INSERT INTO t1 VALUES (3,3);
INSERT INTO t2 VALUES (1);
INSERT INTO t2 VALUES (2);
INSERT INTO t2 VALUES (4);
INSERT INTO t3 VALUES (1);
INSERT INTO t3 VALUES (2);
INSERT INTO t3 VALUES (3);
INSERT INTO t4 VALUES (1);
INSERT INTO t4 VALUES (3);
INSERT INTO t4 VALUES (4);
```



`SELECT a.c1 AS a, b.c1 AS b FROM t1 a, t2 b WHERE b.c1(+)= a.c1 ORDER BY 1;`

` (+)` 의 의미는? 

아우터 기준의 행이 무조건 반환된다. 아우터 조인의 결과를 PASS로 표시.

![image-20200321184405119](https://tva1.sinaimg.cn/large/00831rSTgy1gd1owiphjaj30yi0qw19h.jpg)



## 3. 조인차수

조인되는 테이블의 차수. 데이터 모델의 관계 차수(cardinality)와 유사한 개념이지만, 조인 조건, 조인 기준에 따라 변경될 수 있다는 점.

조인 시 기준이 되는 테이블을 **조인 기준** 

![image-20200321185441370](https://tva1.sinaimg.cn/large/00831rSTgy1gd1p7p9d6hj30u00use81.jpg)



# 기술 순서

FROM 절의 테이블 기술 순서와 WHERE 절의 조건 기술 순서

![image-20200321190404994](https://tva1.sinaimg.cn/large/00831rSTgy1gd1phbvtosj30u012cqm9.jpg)



## 1. FROM 절

- FROM 절의 테이블은 데이터의 논리적인 흐름에 따라 기술.

- 데이터의 논리적인 흐름은 아래의 규칙을 통해 결정

`데이터 모델에 따라 조인 순서를 결정하고, 업무 요건에 따라 조인 순서를 조정.`

![image-20200321191101752](https://tva1.sinaimg.cn/large/00831rSTgy1gd1pok82aij30u011f7wh.jpg)

![image-20200321190922446](https://tva1.sinaimg.cn/large/00831rSTgy1gd1pmtsxl9j30ww0u0h4x.jpg)

## 2. WHERE 절

데이터의 논리적 흐름에 따라 작성. 아래의 규칙에 따라 WHERE 절을 작성하면 데이터의 논리적인 흐름을 쉽게 이해.

```
FROM 절에 첫 번째로 기술된 테이블의 일반 조건을 기술한 다음, FROM절에 기술된 테이블의 순서에 따라 조인 조건과 일반 조건의 순서로 조건을 기술한다. 

조인 조건은 가능한 PK와 FK순서대로 기술하고, 먼저 조회된 테이블의 값이 입력되는 형태로 작성한다.
```

![image-20200321192800798](https://tva1.sinaimg.cn/large/00831rSTgy1gd1q6g27awj30u00xye81.jpg)



# ANSI 조인 문법

지금까지 살펴본 조인 문법은 오라클 조인 문법.

## 1. NATURAL JOIN 절

`NATURAL JOIN` 절은 이름이 같은 열로 테이블을 **등가 조인.**

`SELECT * FROM t1 NATURAL JOIN t2`

## 2. USING 절

`USING 절` 지정한 열로 테이블을 **등가 조인**. 지정한 열은 조인할 테이블에 동일한 이름으로 존재해야 한다. 아래 쿼리는 c1열로 t1, t2 테이블을 등가 조인

`SELECT * FROM t1 JOIN t2 USING (c1);`



## 3. CROSS JOIN 절

`CROSS JOIN` 절은 카티션 곱을 생성. 아래의 좌측 쿼리는 CROSS JOIN 절을 사용한 쿼리.

`SELECT a.c1 AS a, b.c1 AS b FROM t1 a CROSS JOIN t2 b;`

![image-20200321193259009](https://tva1.sinaimg.cn/large/00831rSTgy1gd1qbe4k70j314s078whw.jpg)

## 4. INNER JOIN 절

![image-20200321193317773](https://tva1.sinaimg.cn/large/00831rSTgy1gd1qbpz095j30u00wpb29.jpg)

## 5. OUTER JOIN 절

`LEFT OUTER JOIN, RIGHT OUTER JOIN, FULL OUTER JOIN`

![image-20200321193429715](https://tva1.sinaimg.cn/large/00831rSTgy1gd1qd25tzzj30u00x24qp.jpg)

![image-20200321193446448](https://tva1.sinaimg.cn/large/00831rSTgy1gd1qd8gmp0j30u01564qp.jpg)

![image-20200321193654391](https://tva1.sinaimg.cn/large/00831rSTgy1gd1qfhkt3zj30u0134b1x.jpg)

![image-20200321193707992](https://tva1.sinaimg.cn/large/00831rSTgy1gd1qfox15pj30u014s1kx.jpg)

## 6. ANSI 조인 문법과 오라클 조인 문법

![image-20200321193822783](https://tva1.sinaimg.cn/large/00831rSTgy1gd1qh3lq9tj30um0u0tt6.jpg)

![image-20200321193834706](https://tva1.sinaimg.cn/large/00831rSTgy1gd1qh973rqj30yw0q07i6.jpg)

# 파티션 아우터 조인(partitioned outer join)

파티션 아우터 조인은 QUERY PARTITION 절을 사용

**expr로 파티션을 생성한 후 파티션을 기준으로 아우터 조인.**

```sql
DROP TABLE t1 PURGE;
DROP TABLE t2 PURGE;
CREATE TABLE t1 (c1 NUMBER);
CREATE TABLE t2 (c1 NUMBER, c2 VARCHAR2(1));

INSERT INTO t1 VALUES (1);
INSERT INTO t1 VALUES (2);
INSERT INTO t1 VALUES (3);
INSERT INTO t2 VALUES (1, 'A');
INSERT INTO t2 VALUES (2, 'B');

SELECT a.c1 AS ac1,
       b.c1 AS bc1,
       b.c2 AS bc2
    FROM t1 a
    LEFT OUTER
        JOIN t2 b PARTITION BY (b.c1)
            ON a.c1 = b.c1;
```



파티션 아우터 조인?



# 활용 예제?



#### # 조인 조건

관계의 속성과 관계. 주로 비교 조건과 BETWEEN 조건을 사용하지만 다른 유형의 조건을 사용.

![image-20200321195446969](https://tva1.sinaimg.cn/large/00831rSTgy1gd1qy3iz60j30u00updy8.jpg)

#### # 조인 범위

조인 범위는 관계의 옵셔널리티와 관련. 조인 기준이 아닌 테이블에 대해 필수 관계면 Inner Join, 선택 관계면 Outer Join 으로 조인해야 조인기준이 모두 반환. 

**필수 관계라도 일반 조건이 존재하면 아우터 조인으로 조인해야 조인 기준이 모두 반환**



#### # 조인 차수

조인 차수는 관계의 카디널리티와 관련.

